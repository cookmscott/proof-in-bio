import"../chunks/CWj6FrbW.js";import{p as ba,s as te,b as ya,d as c,a as l,e as wa,f as ve,m as Ve,i as n,j as i,t as y,g as e,k,l as fe,r,h as re}from"../chunks/DP-BcMQ1.js";import{d as Ca,e as De,s as S}from"../chunks/DS5rcHSR.js";import{b as ka,i as x}from"../chunks/CrcHuKx2.js";import{e as Ee,i as We}from"../chunks/BhJnL3fA.js";import{c as $a}from"../chunks/DdC7HWol.js";import{e as qe,B as Ua,a as pe}from"../chunks/Dw4-Sk62.js";import{C as Sa}from"../chunks/DLNyiDlm.js";import{C as Pa}from"../chunks/DnxMfnsY.js";import{C as Aa,a as Ma,b as Va}from"../chunks/CH14Euky.js";import{l as Da,n as Ea,a as Ia,I as Fa,g as Ba,C as ja,f as Na}from"../chunks/BAatBmiI.js";import{c as za,P as Oa,a as Ra}from"../chunks/k2ZzzDzu.js";import{U as La}from"../chunks/CAUmrjWQ.js";import{C as Ge}from"../chunks/B-8xTyCt.js";import{C as me,a as Ke}from"../chunks/Br5xYnQO.js";import{F as Ye}from"../chunks/TZiw9Jiv.js";import{L as Ta}from"../chunks/CKAx8NTr.js";const He=za(Ra,Oa);function Ja(P,A){var $;($=P.target.files)!=null&&$.length&&A(P.target.files)}var Wa=c("<!> <!>",1),qa=(P,A)=>P.key==="Enter"&&A(),Ga=c('<div class="rounded-md bg-destructive/10 p-4 text-sm text-destructive flex items-center gap-2 animate-in fade-in"><!> </div>'),Ka=(P,A,$)=>k(A,e($),!0),Ya=(P,A,$)=>P.key==="Enter"&&k(A,e($),!0),Ha=c('<div class="absolute inset-0 flex items-center justify-center bg-background/50 backdrop-blur-sm"><!></div>'),Qa=c('<div class="absolute top-2 right-2"><div class="bg-destructive text-destructive-foreground p-1.5 rounded-full shadow-sm"><!></div></div>'),Xa=c('<div class="bg-green-500 text-white p-1.5 rounded-full shadow-sm"><!></div>'),Za=c('<div class="bg-emerald-500 text-white p-1.5 rounded-full shadow-sm" title="Capture provenance found and active manifest validates, but capture-manifest validation is unknown in this viewer"><!></div>'),et=c('<div class="bg-blue-500 text-white p-1.5 rounded-full shadow-sm" title="Signed by software (no capture-signed provenance found)"><!></div>'),at=c('<div class="bg-amber-500 text-white p-1.5 rounded-full shadow-sm" title="No verified C2PA signature"><!></div>'),tt=c('<div class="absolute top-2 right-2"><!></div>'),rt=c(`<div role="button" tabindex="0"><img class="w-full h-full object-cover"/> <!> <div class="absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black/80 via-black/40 to-transparent p-3 pt-8
                opacity-0 group-hover:opacity-100 transition-opacity"><p class="text-white text-xs truncate font-medium"> </p> <p class="text-white/70 text-[10px]"> </p></div></div>`),st=c('<li class="text-sm text-muted-foreground flex items-start gap-2"><span class="mt-1.5 h-1.5 w-1.5 rounded-full bg-primary/50 shrink-0"></span> <span> </span></li>'),it=c('<details class="group border rounded-lg bg-card text-card-foreground shadow-sm open:ring-1 open:ring-primary/20"><summary class="flex items-center justify-between p-4 cursor-pointer select-none font-medium hover:bg-muted/50 transition-colors rounded-lg group-open:rounded-b-none"><div class="flex items-center gap-3"><!> </div> <!></summary> <div class="p-4 pt-0 border-t bg-muted/10"><ul class="space-y-2 mt-4"></ul></div></details>'),ot=c('<div class="p-4 border rounded-lg bg-muted/20 text-sm text-muted-foreground text-center">No specific edit actions found in the manifest.</div>'),nt=c('<div class="mt-8 space-y-4 animate-in fade-in slide-in-from-top-2"><h3 class="text-lg font-semibold flex items-center gap-2"><!> </h3> <div class="space-y-2"><!> <!></div></div>'),lt=c('<span class="flex items-center gap-1.5"><!> </span>'),dt=c('<span class="flex items-center gap-1.5"><!> </span>'),ct=c('<span class="flex items-center gap-1.5"><!> </span>'),vt=c('<p class="text-xs text-muted-foreground">“Verified Capture” requires a capture-origin record <em>and</em> validated signatures. “Capture (Unverified)” means capture provenance is present but this viewer can’t confirm capture-manifest validation separately.</p>'),ft=c('<div class="grid grid-cols-2 md:grid-cols-3 gap-4 animate-in fade-in slide-in-from-bottom-4"></div> <!> <div class="flex items-center justify-between pt-6 border-t"><div class="flex-1 space-y-1.5"><div class="flex gap-4 text-sm font-medium flex-wrap"><span class="flex items-center gap-1.5"><!> </span> <!> <!> <!></div> <!></div> <!></div>',1),pt=c('<div role="button" tabindex="0"><input type="file" accept="image/*" multiple class="hidden"/> <div class="flex flex-col items-center gap-4 text-center p-4"><div class="p-4 rounded-full bg-muted"><!></div> <div class="space-y-1"><p class="text-sm font-medium">Drag & drop or click to upload multiple images</p> <p class="text-xs text-muted-foreground">Supports JPEG, PNG, WebP</p></div></div></div> <!> <!>',1),mt=c("<!> <!>",1),ut=c('<div class="container mx-auto max-w-2xl py-12 px-4"><!></div>');function Et(P,A){ba(A,!0);let $=te(!1),m=te(ya([])),ue=te(null),j=te(null),N=te(null);const Qe=a=>!!(a!=null&&a.c2pa),Ie=a=>{var s;return!!((s=a==null?void 0:a.c2pa)!=null&&s.hasManifest)},ge=a=>{var s;return Ie(a)&&((s=a.c2pa)==null?void 0:s.activeSignatureValidated)===!0},_e=a=>{var s;return((s=a.c2pa)==null?void 0:s.hasCaptureProvenance)===!0},Fe=a=>{var s;return(s=a.c2pa)==null?void 0:s.captureSignatureValidated},se=a=>ge(a)&&_e(a)&&Fe(a)===!0,Be=a=>ge(a)&&_e(a)&&Fe(a)==null,je=a=>ge(a)&&!_e(a),Xe=a=>{var s;return!Ie(a)||((s=a.c2pa)==null?void 0:s.activeSignatureValidated)!==!0},Ze=a=>{var s;return se(a)&&((s=a.c2pa)==null?void 0:s.activeIsCapture)===!1};let ie=re(()=>e(m).filter(se).length),he=re(()=>e(m).filter(Be).length),xe=re(()=>e(m).filter(je).length),be=re(()=>e(m).filter(Xe).length);async function Ne(a){if(!a||a.length===0)return;if(k(j,null),a.length>10){k(j,"Please select 10 or fewer images at a time.");return}const s=new Set(e(m).map(d=>`${d.file.name}|${d.file.size}|${d.file.lastModified}`)),w=Array.from(a).filter(d=>{if(!d.type.startsWith("image/"))return!1;const h=`${d.name}|${d.size}|${d.lastModified}`;return s.has(h)?!1:(s.add(h),!0)});if(a.length>0&&w.length===0){k(j,"All selected images are already in the list or are not valid image types.");return}if(w.length===0)return;const u=w.map(d=>({id:Math.random().toString(36).substring(7),file:d,previewUrl:URL.createObjectURL(d),processing:!0,c2pa:null,error:null}));k(m,[...e(m),...u],!0);for(const d of u)await ea(d)}async function ea(a){var s;try{const u=await(await Da()).reader.fromBlob(a.file.type,a.file);let d=null,h={hasManifest:!1};if(u){const U=await u.manifestStore(),f=Ea(U);h=Ia(f)||{hasManifest:!1},h.hasManifest&&(d=U,console.group(`C2PA Analysis: ${a.file.name}`),console.log("Analysis Result:",h),console.log("Manifest Store (Raw):",U),console.log("Active Manifest ID:",f.active_manifest),console.log("Active Manifest Data:",(s=f.manifests)==null?void 0:s[f.active_manifest]),console.groupEnd())}const V=e(m).findIndex(U=>U.id===a.id);V!==-1&&(e(m)[V].c2pa={...h,data:d},e(m)[V].processing=!1)}catch(w){console.error("Error processing image:",w);const u=e(m).findIndex(d=>d.id===a.id);u!==-1&&(e(m)[u].error="Failed to process",e(m)[u].processing=!1)}}function aa(a){var s;a.preventDefault(),k($,!1),(s=a.dataTransfer.files)!=null&&s.length&&Ne(a.dataTransfer.files)}function ta(a){a.preventDefault(),k($,!0)}function ra(){k($,!1)}function ze(){var a;(a=e(ue))==null||a.click()}async function sa(){const a=e(m).filter(se);if(a.length===0)return;const{data:{session:s},error:w}=await He.auth.getSession();if(w){k(j,w.message,!0);return}if(!(s!=null&&s.access_token)){k(j,"Not logged in / no access token");return}console.log("access token (first 20 chars):",s.access_token.slice(0,20)),console.log("looks like JWT:",s.access_token.split(".").length===3);for(const u of a){const d=new FormData;d.append("file",u.file),d.append("metadata",JSON.stringify({title:u.file.name}));try{const{data:h,error:V}=await He.functions.invoke("photo-upload",{body:d,headers:{Authorization:`Bearer ${s.access_token}`}});if(V)throw V}catch(h){console.error("Upload failed",h),u.error=h.message}}}var ye=ut(),ia=i(ye);Sa(ia,{children:(a,s)=>{var w=mt(),u=ve(w);Aa(u,{children:(h,V)=>{var U=Wa(),f=ve(U);Ma(f,{children:(T,oe)=>{fe();var H=Ve("Upload Images");l(T,H)},$$slots:{default:!0}});var Y=n(f,2);Va(Y,{children:(T,oe)=>{fe();var H=Ve("Upload images to verify their C2PA metadata locally in your browser.");l(T,H)},$$slots:{default:!0}}),l(h,U)},$$slots:{default:!0}});var d=n(u,2);Pa(d,{class:"space-y-6",children:(h,V)=>{var U=pt(),f=ve(U);f.__click=ze,f.__keydown=[qa,ze];var Y=i(f);Y.__change=[Ja,Ne],ka(Y,M=>k(ue,M),()=>e(ue));var T=n(Y,2),oe=i(T),H=i(oe);La(H,{class:"h-8 w-8 text-muted-foreground"}),r(oe),fe(2),r(T),r(f);var Oe=n(f,2);{var oa=M=>{var J=Ga(),W=i(J);Ge(W,{class:"h-4 w-4"});var ne=n(W);r(J),y(()=>S(ne,` ${e(j)??""}`)),l(M,J)};x(Oe,M=>{e(j)&&M(oa)})}var na=n(Oe,2);{var la=M=>{var J=ft(),W=ve(J);Ee(W,21,()=>e(m),o=>o.id,(o,t)=>{var v=rt();v.__click=[Ka,N,t],v.__keydown=[Ya,N,t];var g=i(v),Q=n(g,2);{var $e=p=>{var _=Ha(),z=i(_);Ta(z,{class:"h-8 w-8 animate-spin text-primary"}),r(_),l(p,_)},le=(p,_)=>{{var z=D=>{var O=Qa(),E=i(O),I=i(E);Ge(I,{class:"h-5 w-5"}),r(E),r(O),y(()=>pe(E,"title",e(t).error)),l(D,O)},de=(D,O)=>{{var E=I=>{var R=tt(),q=i(R);{var ee=F=>{var B=Xa(),Se=i(B);me(Se,{class:"h-5 w-5"}),r(B),y(Pe=>pe(B,"title",Pe),[()=>Ze(e(t))?"Verified (edited, but traceable to capture-signed origin)":"Verified Capture (device/camera signed)"]),l(F,B)},ce=(F,B)=>{{var Se=G=>{var ae=Za(),Ae=i(ae);me(Ae,{class:"h-5 w-5"}),r(ae),l(G,ae)},Pe=(G,ae)=>{{var Ae=K=>{var L=et(),Me=i(L);Ye(Me,{class:"h-5 w-5"}),r(L),l(K,L)},xa=K=>{var L=at(),Me=i(L);Ke(Me,{class:"h-5 w-5"}),r(L),l(K,L)};x(G,K=>{je(e(t))?K(Ae):K(xa,!1)},ae)}};x(F,G=>{Be(e(t))?G(Se):G(Pe,!1)},B)}};x(q,F=>{se(e(t))?F(ee):F(ce,!1)})}r(R),l(I,R)};x(D,I=>{Qe(e(t))&&I(E)},O)}};x(p,D=>{e(t).error?D(z):D(de,!1)},_)}};x(Q,p=>{e(t).processing?p($e):p(le,!1)})}var X=n(Q,2),Z=i(X),Ue=i(Z,!0);r(Z);var b=n(Z,2),C=i(b);r(b),r(X),r(v),y(p=>{var _;qe(v,1,`relative aspect-square rounded-lg overflow-hidden border bg-muted/30 group cursor-pointer transition-all
              ${((_=e(N))==null?void 0:_.id)===e(t).id?"ring-2 ring-primary ring-offset-2":"hover:border-primary/50"}`),pe(g,"src",e(t).previewUrl),pe(g,"alt",e(t).file.name),S(Ue,e(t).file.name),S(C,`${p??""} KB`)},[()=>(e(t).file.size/1024).toFixed(0)]),l(o,v)}),r(W);var ne=n(W,2);{var da=o=>{var t=nt();const v=re(()=>(()=>{const b={};for(const C of e(N).c2pa.actions||[]){const p=Ba(C.action),_=p.label;b[_]||(b[_]={category:p,actions:[]}),b[_].actions.push(C)}return Object.values(b).sort((C,p)=>C.category.order-p.category.order)})());var g=i(t),Q=i(g);Fa(Q,{class:"h-5 w-5"});var $e=n(Q);r(g);var le=n(g,2),X=i(le);Ee(X,17,()=>e(v),We,(b,C)=>{var p=it(),_=i(p),z=i(_),de=i(z);$a(de,()=>e(C).category.icon,(R,q)=>{q(R,{class:"h-5 w-5 text-primary"})});var D=n(de);r(z);var O=n(z,2);ja(O,{class:"h-4 w-4 text-muted-foreground transition-transform duration-200 group-open:rotate-180"}),r(_);var E=n(_,2),I=i(E);Ee(I,21,()=>e(C).actions,We,(R,q)=>{var ee=st(),ce=n(i(ee),2),F=i(ce,!0);r(ce),r(ee),y(B=>S(F,B),[()=>Na(e(q))||e(q).action]),l(R,ee)}),r(I),r(E),r(p),y(()=>S(D,` ${e(C).category.label??""}`)),l(b,p)});var Z=n(X,2);{var Ue=b=>{var C=ot();l(b,C)};x(Z,b=>{e(v).length===0&&b(Ue)})}r(le),r(t),y(()=>S($e,` Edits for ${e(N).file.name??""}`)),l(o,t)};x(ne,o=>{var t;e(N)&&((t=e(N).c2pa)!=null&&t.hasManifest)&&o(da)})}var Re=n(ne,2),we=i(Re),Ce=i(we),ke=i(Ce),Le=i(ke);me(Le,{class:"h-4 w-4 text-green-500"});var ca=n(Le);r(ke);var Te=n(ke,2);{var va=o=>{var t=lt(),v=i(t);me(v,{class:"h-4 w-4 text-emerald-500"});var g=n(v);r(t),y(()=>S(g,` ${e(he)??""} Capture (Unverified)`)),l(o,t)};x(Te,o=>{e(he)>0&&o(va)})}var Je=n(Te,2);{var fa=o=>{var t=dt(),v=i(t);Ye(v,{class:"h-4 w-4 text-blue-500"});var g=n(v);r(t),y(()=>S(g,` ${e(xe)??""} Signed by Software`)),l(o,t)};x(Je,o=>{e(xe)>0&&o(fa)})}var pa=n(Je,2);{var ma=o=>{var t=ct(),v=i(t);Ke(v,{class:"h-4 w-4 text-amber-500"});var g=n(v);r(t),y(()=>S(g,` ${e(be)??""} Unsigned / Not Verified`)),l(o,t)};x(pa,o=>{e(be)>0&&o(ma)})}r(Ce);var ua=n(Ce,2);{var ga=o=>{var t=vt();l(o,t)};x(ua,o=>{(e(be)>0||e(xe)>0||e(he)>0)&&o(ga)})}r(we);var _a=n(we,2);{var ha=o=>{Ua(o,{onclick:sa,children:(t,v)=>{fe();var g=Ve();y(()=>S(g,`Upload ${e(ie)??""} Verified ${e(ie)===1?"Image":"Images"}`)),l(t,g)},$$slots:{default:!0}})};x(_a,o=>{e(ie)>0&&o(ha)})}r(Re),y(()=>S(ca,` ${e(ie)??""} Verified Capture`)),l(M,J)};x(na,M=>{e(m).length>0&&M(la)})}y(()=>qe(f,1,`relative flex flex-col items-center justify-center w-full h-64 rounded-xl border-2 border-dashed transition-colors cursor-pointer outline-none
        ${e($)?"border-primary bg-primary/5":"border-muted-foreground/25 hover:border-primary/50 hover:bg-muted/50"}`)),De("dragover",f,ta),De("dragleave",f,ra),De("drop",f,aa),l(h,U)},$$slots:{default:!0}}),l(a,w)},$$slots:{default:!0}}),r(ye),l(P,ye),wa()}Ca(["click","keydown","change"]);export{Et as component};
