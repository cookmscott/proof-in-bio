import{i as E,a as L,p as x,b as T}from"./D0n4zEEC.js";function H(a){const r=JSON.parse(a);return r.data&&(r.data=x(r.data,T.decoders)),r}function l(a){return HTMLElement.prototype.cloneNode.call(a)}function k(a,r=()=>{}){const u=async({action:e,result:c,reset:i=!0,invalidateAll:o=!0})=>{c.type==="success"&&(i&&HTMLFormElement.prototype.reset.call(a),o&&await E()),(location.origin+location.pathname===e.origin+e.pathname||c.type==="redirect"||c.type==="error")&&await L(c)};async function d(e){var f,b,y;if(((f=e.submitter)!=null&&f.hasAttribute("formmethod")?e.submitter.formMethod:l(a).method)!=="post")return;e.preventDefault();const i=new URL((b=e.submitter)!=null&&b.hasAttribute("formaction")?e.submitter.formAction:l(a).action),o=(y=e.submitter)!=null&&y.hasAttribute("formenctype")?e.submitter.formEnctype:l(a).enctype,s=new FormData(a,e.submitter),m=new AbortController;let p=!1;const w=await r({action:i,cancel:()=>p=!0,controller:m,formData:s,formElement:a,submitter:e.submitter})??u;if(p)return;let n;try{const t=new Headers({accept:"application/json","x-sveltekit-action":"true"});o!=="multipart/form-data"&&t.set("Content-Type",/^(:?application\/x-www-form-urlencoded|text\/plain)$/.test(o)?o:"application/x-www-form-urlencoded");const A=o==="multipart/form-data"?s:new URLSearchParams(s),h=await fetch(i,{method:"POST",headers:t,cache:"no-store",body:A,signal:m.signal});n=H(await h.text()),n.type==="error"&&(n.status=h.status)}catch(t){if((t==null?void 0:t.name)==="AbortError")return;n={type:"error",error:t}}await w({action:i,formData:s,formElement:a,update:t=>u({action:i,result:n,reset:t==null?void 0:t.reset,invalidateAll:t==null?void 0:t.invalidateAll}),result:n})}return HTMLFormElement.prototype.addEventListener.call(a,"submit",d),{destroy(){HTMLFormElement.prototype.removeEventListener.call(a,"submit",d)}}}export{k as e};
